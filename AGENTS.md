# AGENTS.md

This file provides guidance to AI agents when working with code in this repository.

## Project Overview

Cloud resume project originally built for the [Cloud Resume Challenge](https://cloudresumechallenge.dev/). The live resume is deployed to Azure Blob Storage and accessible at https://resume.joshrnoll.com.

## Architecture

This project uses a **hybrid resume generation system** with a single source of truth:

- **Input**: `resume.yaml` contains resume content using [RenderCV schema format](https://docs.rendercv.com/user_guide/yaml_input_structure/cv/)
- **Dual Output System**:
  - **HTML**: Generated via Jinja2 template (`templates/resume.html.jinja`)
  - **PDF**: Generated via `rendercv` CLI tool
- **Build Process**: `make.py` orchestrates the entire build:
  1. Runs `rendercv render resume.yaml` to generate PDF and other formats
  2. Renders HTML from `resume.yaml` using Jinja2 template
  3. Copies both `index.html` and `resume.pdf` to `src/` directory
- **Deployment**: Gitea Actions workflow syncs `src/` to Azure Blob Storage on push to main
- **User Experience**: Resume site includes four action buttons (My Website, LinkedIn, GitHub, PDF Download)

## Development Setup

Set up Python virtual environment:

```bash
python -m venv ./venv
source ./venv/bin/activate
pip install -r requirements.txt
```

Dependencies (from `requirements.txt`):

- `rendercv[full]` - CV generator for PDF and other format outputs
- `jinja2 >= 3.1.6` - Template engine for HTML generation
- `pyyaml >= 6.0.2` - YAML parsing

## Common Commands

### Build Resume

```bash
python make.py
```

This command:
1. Runs `rendercv render resume.yaml` to generate PDF and other formats in `rendercv_output/`
2. Renders HTML from `resume.yaml` using the Jinja2 template
3. Copies `index.html` and `resume.pdf` to the `src/` directory

### Render PDF Only (Manual)

```bash
rendercv render resume.yaml
```

Generates multiple output formats in `rendercv_output/` directory (PDF, PNG, HTML, Markdown, Typst). The `make.py` script handles this automatically, so manual execution is rarely needed.

### Deploy to Azure Blob Storage

```bash
azcopy sync "./src" "https://<storage-account>.blob.core.windows.net/%24web?<sas-token>" --recursive --delete-destination=true
```

**Note**: Manual deployment requires `azcopy` installed (`brew install azcopy` on macOS). Normally deployment happens automatically via Gitea Actions on push to main.

### Install azcopy

```bash
brew install azcopy  # macOS
```

## CI/CD

Gitea Actions workflow (`.gitea/workflows/action.yaml`):

- Triggers on push to `main` branch
- Sets up Python venv and installs dependencies
- Runs `python make.py` to build the site (generates both HTML and PDF)
- Syncs `src/` directory (including `index.html` and `resume.pdf`) to Azure Blob Storage using azcopy
- Uses `secrets.endpoint_sas_url` for Azure authentication

## Directory Structure

- `resume.yaml` - Resume content in RenderCV schema format (single source of truth)
- `make.py` - Build script that generates HTML (via Jinja2) and PDF (via rendercv)
- `templates/` - Jinja2 templates for HTML generation
  - `resume.html.jinja` - Main template adapted to RenderCV schema
- `src/` - Static website files deployed to Azure (HTML, CSS, JS, PDF, 404 page)
  - `index.html` - Generated from Jinja2 template
  - `resume.pdf` - Generated by rendercv and copied here by make.py
- `rendercv_output/` - RenderCV generated outputs (PDF, PNG, HTML, Markdown, Typst) - git ignored
- `.gitea/workflows/` - Gitea Actions CI/CD configuration
- `.devcontainer/` - VSCode Dev Container configuration with custom dotfiles setup

## Working with Resume Content

Edit `resume.yaml` to update resume content. The file follows the [RenderCV schema](https://docs.rendercv.com/user_guide/yaml_input_structure/cv/) with a schema reference on line 1 for validation and autocomplete in supported editors.

After editing `resume.yaml`, run `python make.py` to regenerate both HTML and PDF outputs.

### Resume Site Features

The generated HTML (`src/index.html`) includes four action buttons beneath the name/title:
- **My Website** - Links to personal website
- **My LinkedIn** - Links to LinkedIn profile
- **My GitHub** - Links to GitHub profile
- **PDF Download** - Downloads the `resume.pdf` generated by rendercv

## Dev Container

The `.devcontainer/` setup provides a consistent development environment:

- Based on Microsoft's Python 3.12 devcontainer
- Installs Homebrew and development tools (neovim, chezmoi, sops, etc.)
- Automatically applies user's dotfiles from https://github.com/joshrnoll/dotfiles.git
- Pre-installs Python dependencies from requirements.txt
